@isTest
public class OPAAttachmentTriggerTest {

public static testMethod void myUnitTest() {

        Account acc = new Account(name='Test Account');
        acc.Territory_Name_TAMS__c = 'US.GL.2660100.TR-101';
        insert acc;

        Opportunity op = new Opportunity();
        op.Name='testOpName';
        op.Expected_Bill_Date_TAMS__c     = Date.today() + 2;
        op.CloseDate                      =  Date.today()+1;
        op.StageName                      = 'Closed/Lost';
        op.Lost_Cancelled_Reason_TAMS__c  = 'Functionality/Insufficient Technology';
        op.Competitor_Lost_to_TAMS__c     = 'GE';
        op.LeadSource                     = 'Cold Call';
        op.Incumbent_TAMS__c              = 'GE';
        op.Competitor_Lost_to_TAMS__c     = 'GE';
        op.Is_this_Product_Funded_TAMS__c = 'Yes';
        op.Additional_Comments_TAMS__c    = 'Test Comments';
        op.Actual_Book_Date_TAMS__c       = Date.today();
        insert op;   
        
        TAMS_Quotes__c qt = new TAMS_Quotes__c();
        qt.Opportunity_Name__c            = op.id;
        qt.Customer_Name__c               = acc.id;
        qt.Modality__c                    = 'CT';
        qt.PBOM__c                        = 'AQ64/VELOCT/UPG.000';
        qt.Quote_Name__c                  = 'OPAAttachmentTriggerTestQuote';
        qt.Quote_Version__c               = '1';
        qt.Status__c                      = 'Quote Generated by HQ';
        qt.Amount__c                      = 4000;
        insert qt;        

        TAMS_Order_Process_Approval__c topa = new TAMS_Order_Process_Approval__c();
        topa.Account__c                   = acc.id;
        topa.Opportunity__c               = op.id;
        topa.TAMS_Quote__c                = qt.id;
        topa.Payment_Method__c            = 'PO Paying';
        topa.Total_Contract_Price__c      = 'Yes';
        topa.BOM__c                       = 'Yes';
        topa.Added_Purchasable_Options__c = 'Yes';
        topa.Handwritten_Notes__c         = 'Yes';
        topa.POP_Service_Contract__c      = 'Yes';
        topa.Trade_in_Included__c         = 'Yes';
        topa.Non_Standard_Terms_form__c   = 'Yes';
        topa.Down_Payment_Check__c        = 'Yes';
        topa.Multi_System_Deal__c         = 'Yes';
        topa.Handwritten_Notes1__c        = 'Test handwritten Notes';
        topa.If_Multi_System_list_opportunity_SIDs__c = 'Yes';
        insert topa;
        
        Order_Attachment__c oa = new Order_Attachment__c();
        oa.TAMS_OPA__c      = topa.id;
        oa.Document_Type__c = 'PO';
        oa.Description__c   = 'HK OAP Trigger Test Attachement';
        insert oa;
        
        Attachment att = new Attachment();
        att.parentid   = oa.id;
        att.name       = 'opa_trigger.pdf';
        Blob bodyBlob  = Blob.valueOf('Unit Test Attachment HK');
        att.body       = bodyBlob;
        insert att;
        
        List<Attachment> attachments=[select id, name from Attachment where parent.id= :oa.id];
        System.assertEquals(1, attachments.size());
 }
public static testMethod void testOPAAttachment() {

                Account acc = new Account(name='Test Account');
                acc.Territory_Name_TAMS__c = 'US.GL.2660100.TR-101';
                insert acc;

                Opportunity op = new Opportunity();
                op.Name='testOpName';
                op.Expected_Bill_Date_TAMS__c     = Date.today() + 2;
                op.CloseDate                      =  Date.today()+1;
                op.StageName                      = 'Closed/Lost';
                op.Lost_Cancelled_Reason_TAMS__c  = 'Functionality/Insufficient Technology';
                op.Competitor_Lost_to_TAMS__c     = 'GE';
                op.LeadSource                     = 'Cold Call';
                op.Incumbent_TAMS__c              = 'GE';
                op.Competitor_Lost_to_TAMS__c     = 'GE';
                op.Is_this_Product_Funded_TAMS__c = 'Yes';
                op.Additional_Comments_TAMS__c    = 'Test Comments';
                op.Actual_Book_Date_TAMS__c       = Date.today();
                insert op;   
                
                TAMS_Quotes__c qt = new TAMS_Quotes__c();
                qt.Opportunity_Name__c            = op.id;
                qt.Customer_Name__c               = acc.id;
                qt.Modality__c                    = 'CT';
                qt.PBOM__c                        = 'AQ64/VELOCT/UPG.000';
                qt.Quote_Name__c                  = 'OPAAttachmentTriggerTestQuote';
                qt.Quote_Version__c               = '1';
                qt.Status__c                      = 'Quote Generated by HQ';
                qt.Amount__c                      = 4000;
                insert qt;        

                TAMS_Order_Process_Approval__c topa = new TAMS_Order_Process_Approval__c();
                topa.Account__c                   = acc.id;
                topa.Opportunity__c               = op.id;
                topa.TAMS_Quote__c                = qt.id;
                topa.Payment_Method__c            = 'PO Paying';
                topa.Total_Contract_Price__c      = 'Yes';
                topa.BOM__c                       = 'Yes';
                topa.Added_Purchasable_Options__c = 'Yes';
                topa.Handwritten_Notes__c         = 'Yes';
                topa.POP_Service_Contract__c      = 'Yes';
                topa.Trade_in_Included__c         = 'Yes';
                topa.Non_Standard_Terms_form__c   = 'Yes';
                topa.Down_Payment_Check__c        = 'Yes';
                topa.Multi_System_Deal__c         = 'Yes';
                topa.Handwritten_Notes1__c        = 'Test handwritten Notes';
                topa.If_Multi_System_list_opportunity_SIDs__c = 'Yes';
                insert topa;
                
                Order_Attachment__c oa = new Order_Attachment__c();
                oa.TAMS_OPA__c      = topa.id;
                oa.Document_Type__c = 'PO';
                oa.Description__c   = 'PS OAP Trigger Test Attachement';
                oa.public__c  = true;
                insert oa;
                
                Attachment att = new Attachment();
                att.parentid   = oa.id;
                att.name       = 'opa_trigger.pdf';
                Blob bodyBlob  = Blob.valueOf('Unit Test Attachment PS');
                att.body       = bodyBlob;
                Test.startTest();
                insert att;
                Test.stopTest();

                List<Attachment> attachments=[select id, name from Attachment where parent.id= :oa.TAMS_OPA__c];
                System.assertEquals(1, attachments.size());
        }

public static testMethod void testNOOPAAttachment() {

                Account acc = new Account(name='Test Account');
                acc.Territory_Name_TAMS__c = 'US.GL.2660100.TR-101';
                insert acc;

                Opportunity op = new Opportunity();
                op.Name='testOpName';
                op.Expected_Bill_Date_TAMS__c     = Date.today() + 2;
                op.CloseDate                      =  Date.today()+1;
                op.StageName                      = 'Closed/Lost';
                op.Lost_Cancelled_Reason_TAMS__c  = 'Functionality/Insufficient Technology';
                op.Competitor_Lost_to_TAMS__c     = 'GE';
                op.LeadSource                     = 'Cold Call';
                op.Incumbent_TAMS__c              = 'GE';
                op.Competitor_Lost_to_TAMS__c     = 'GE';
                op.Is_this_Product_Funded_TAMS__c = 'Yes';
                op.Additional_Comments_TAMS__c    = 'Test Comments';
                op.Actual_Book_Date_TAMS__c       = Date.today();
                insert op;   
                
                TAMS_Quotes__c qt = new TAMS_Quotes__c();
                qt.Opportunity_Name__c            = op.id;
                qt.Customer_Name__c               = acc.id;
                qt.Modality__c                    = 'CT';
                qt.PBOM__c                        = 'AQ64/VELOCT/UPG.000';
                qt.Quote_Name__c                  = 'OPAAttachmentTriggerTestQuote';
                qt.Quote_Version__c               = '1';
                qt.Status__c                      = 'Quote Generated by HQ';
                qt.Amount__c                      = 4000;
                insert qt;        

                TAMS_Order_Process_Approval__c topa = new TAMS_Order_Process_Approval__c();
                topa.Account__c                   = acc.id;
                topa.Opportunity__c               = op.id;
                topa.TAMS_Quote__c                = qt.id;
                topa.Payment_Method__c            = 'PO Paying';
                topa.Total_Contract_Price__c      = 'Yes';
                topa.BOM__c                       = 'Yes';
                topa.Added_Purchasable_Options__c = 'Yes';
                topa.Handwritten_Notes__c         = 'Yes';
                topa.POP_Service_Contract__c      = 'Yes';
                topa.Trade_in_Included__c         = 'Yes';
                topa.Non_Standard_Terms_form__c   = 'Yes';
                topa.Down_Payment_Check__c        = 'Yes';
                topa.Multi_System_Deal__c         = 'Yes';
                topa.Handwritten_Notes1__c        = 'Test handwritten Notes';
                topa.If_Multi_System_list_opportunity_SIDs__c = 'Yes';
                insert topa;
                
                Order_Attachment__c oa = new Order_Attachment__c();
                oa.TAMS_OPA__c      = topa.id;
                oa.Document_Type__c = 'PO';
                oa.Description__c   = 'PS OAP Trigger Test Attachement';
                oa.public__c  = false;
                insert oa;
                
                Attachment att = new Attachment();
                att.parentid   = oa.id;
                att.name       = 'opa_trigger.pdf';
                Blob bodyBlob  = Blob.valueOf('Unit Test Attachment PS');
                att.body       = bodyBlob;
                Test.startTest();
                insert att;
                Test.stopTest();

                List<Attachment> attachments=[select id, name from Attachment where parent.id= :oa.TAMS_OPA__c];
                System.assertEquals(0, attachments.size());
        }
/**
public static testMethod void testBulkOPAAttachments() {

                Account acc = new Account(name='Test Account');
                acc.Territory_Name_TAMS__c = 'US.GL.2660100.TR-101';
                insert acc;

                Opportunity op = new Opportunity();
                op.Name='testOpName';
                op.Expected_Bill_Date_TAMS__c     = Date.today() + 2;
                op.CloseDate                      =  Date.today()+1;
                op.StageName                      = 'Closed/Lost';
                op.Lost_Cancelled_Reason_TAMS__c  = 'Functionality/Insufficient Technology';
                op.Competitor_Lost_to_TAMS__c     = 'GE';
                op.LeadSource                     = 'Cold Call';
                op.Incumbent_TAMS__c              = 'GE';
                op.Competitor_Lost_to_TAMS__c     = 'GE';
                op.Is_this_Product_Funded_TAMS__c = 'Yes';
                op.Additional_Comments_TAMS__c    = 'Test Comments';
                op.Actual_Book_Date_TAMS__c       = Date.today();
                insert op;   
                
                TAMS_Quotes__c qt = new TAMS_Quotes__c();
                qt.Opportunity_Name__c            = op.id;
                qt.Customer_Name__c               = acc.id;
                qt.Modality__c                    = 'CT';
                qt.PBOM__c                        = 'AQ64/VELOCT/UPG.000';
                qt.Quote_Name__c                  = 'OPAAttachmentTriggerTestQuote';
                qt.Quote_Version__c               = '1';
                qt.Status__c                      = 'Quote Generated by HQ';
                qt.Amount__c                      = 4000;
                insert qt;        

                TAMS_Order_Process_Approval__c topa = new TAMS_Order_Process_Approval__c();
                topa.Account__c                   = acc.id;
                topa.Opportunity__c               = op.id;
                topa.TAMS_Quote__c                = qt.id;
                topa.Payment_Method__c            = 'PO Paying';
                topa.Total_Contract_Price__c      = 'Yes';
                topa.BOM__c                       = 'Yes';
                topa.Added_Purchasable_Options__c = 'Yes';
                topa.Handwritten_Notes__c         = 'Yes';
                topa.POP_Service_Contract__c      = 'Yes';
                topa.Trade_in_Included__c         = 'Yes';
                topa.Non_Standard_Terms_form__c   = 'Yes';
                topa.Down_Payment_Check__c        = 'Yes';
                topa.Multi_System_Deal__c         = 'Yes';
                topa.Handwritten_Notes1__c        = 'Test handwritten Notes';
                topa.If_Multi_System_list_opportunity_SIDs__c = 'Yes';
                insert topa;
                
                Order_Attachment__c oa = new Order_Attachment__c();
                oa.TAMS_OPA__c      = topa.id;
                oa.Document_Type__c = 'PO';
                oa.Description__c   = 'PS OAP Trigger Test Attachement';
                oa.public__c  = true;
                insert oa;
                
                List<Attachment> attms = new List<Attachment>();
                for(Integer i=0;i<50;i++){
                        Attachment att = new Attachment();
                        att.parentid   = oa.id;
                        att.name       = 'opa_trigger'+i+'.pdf';
                        Blob bodyBlob  = Blob.valueOf('Unit Test Attachment PS'+i);
                        att.body       = bodyBlob;
                        attms.add(att);
                }

                Test.startTest();
                insert attms;
                Test.stopTest();

                List<Attachment> attachments=[select id, name from Attachment where parent.id= :oa.TAMS_OPA__c];
                System.assertEquals(50, attachments.size());
        }        
**/        
}